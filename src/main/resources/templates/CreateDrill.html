<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Create New Drill</title>
    <link rel="stylesheet" th:href="@{/drill-creation.css}">
    <link rel="stylesheet" th:href="@{/chosen-drill/drill-management.css}">
    <link rel="stylesheet" th:href="@{/autocomplete.css}">
    <link rel="stylesheet" th:href="@{/chosen-drill/style.css}">
    <link rel="stylesheet" th:href="@{/chosen-user/chosen-old.css}">
    <link rel="stylesheet" th:href="@{/timepicker.css}">

    <link rel="stylesheet"
          href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@48,400,0,0"/>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/timepicker/1.3.5/jquery.timepicker.min.js"
            type="text/javascript"></script>
    <script th:src="@{/js/chosen.jquery.js}" type="text/javascript"></script>
    <script src="https://kit.fontawesome.com/a665c629bb.js" crossorigin="anonymous"></script>

    <script type="text/javascript" th:src="@{/js/drill-editor.js}"></script>
    <script type="text/javascript" th:src="@{/js/autocomplete.js}"></script>
</head>

<script th:inline="javascript">
    drill = [[${drill}]];
    editing = [[${editing}]];
</script>

<body class="body-container" onload="initDrillEditor()">

<aside class="sidebar">
    <ul class="sidebar-list">
        <li class="sidebar-item">
            <a href="#" class="item-link">
                <span class="material-symbols-outlined">logout</span>
                <span class="item-text">Log Out</span>
            </a>
        </li>
    </ul>
</aside>

<main class="drill-management-main">

    <!--    <div id="main-container" class="main-container">-->

    <div class="left">
        <div class="top-left">
            <h1>Drill List</h1>
        </div>
        <div class="bottom-left"></div>
    </div>

    <div class="right">

        <div class="top-right">
            <h1>Drill Editor</h1>
        </div>

        <div class="bottom-right drill-editor-div drill-management-editor-div">

                <form th:action="@{/create-drill}" th:object="${newDrill}" method="post" id="drill-creation-form"
                      class="drill-management-table-form" autocomplete="off">

                    <table class="drill-management-table">
                        <tr>
                            <th class="drill-management-entry">Title</th>
                            <td class="drill-management-value-cell">
                                <input id="drill-title" class="drill-management-value" type="text"
                                       th:name="title">
                            </td>
                        </tr>

                        <tr>
                            <th class="drill-management-entry">Color</th>
                            <td class="drill-management-value-cell">
                                <select id='drill-color' class="drill-management-value" th:name="color">
                                    <option selected disabled style="display: none">Select one...</option>
                                    <option style="background-color: #F89EB9" value="#F89EB9">Red</option>
                                    <option style="background-color: #ECD583" value="#ECD583">Yellow</option>
                                    <option style="background-color: #AEE583" value="#AEE583">Green</option>
                                    <option style="background-color: #A6D4FF" value="#A6D4FF">Blue</option>
                                </select>
                            </td>
                        </tr>

                        <tr>
                            <th class="drill-management-entry">Date</th>
                            <td class="drill-management-value-cell">
                                <input id="drill-date" class="drill-management-value" type="date" th:name="date">
                            </td>
                        </tr>

                        <tr>
                            <th class="drill-management-entry">Start Time</th>
                            <td class="drill-management-value-cell">
                                <input type="text" class="drill-management-value" required id="drill-start-time"
                                       th:name="startTime">
                                <script>
                                    $(document).ready(function () {
                                        $("#drill-start-time").timepicker({
                                            timeFormat: 'HH:mm',
                                            interval: '15',
                                            minTime: '5',
                                            maxTime: '22',
                                            startTime: '500',
                                            dynamic: true,
                                            dropdown: true,
                                            scrollbar: true,

                                            change: function (time) {
                                                console.log("Time updated");

                                                var startHour = parseInt($('#drill-start-time').val().substring(0, 2));
                                                var startMinutes = parseInt($('#drill-start-time').val().substring(3, 8)) + 15;
                                                var endMinTime = (startHour).toString().concat(':' + startMinutes);

                                                $('#drill-end-time').timepicker('option', 'minTime', endMinTime);
                                                $('#drill-end-time').timepicker('setTime', endMinTime);

                                                // console.log(parseInt($('#drill-start-time').val().substring(0, 2)));
                                                // $("#drill-end-time").timepicker('option',{
                                                //     'minHour': this.hour
                                                // });
                                            }
                                        });
                                    });
                                </script>
                            </td>
                        </tr>

                        <tr>
                            <th class="drill-management-entry">End Time</th>
                            <td class="drill-management-value-cell">
                                <input type="text" class="drill-management-value" required id="drill-end-time"
                                       th:name="endTime">
                                <script>
                                    $(document).ready(function () {
                                        $("#drill-end-time").timepicker({
                                            timeFormat: 'HH:mm',
                                            interval: '15',
                                            minTime: '5',
                                            maxTime: '22',
                                            startTime: '500',
                                            dynamic: true,
                                            dropdown: true,
                                            scrollbar: true,
                                        });
                                    });
                                </script>
                            </td>
                        </tr>

                        <tr>
                            <th class="drill-management-entry">Location</th>
                            <td class="drill-management-value-cell">
                                <select id="drill-location" name="drill-location" class="drill-management-value"
                                        th:name="location">-->
                                    <option selected disabled style="display: none">Select location...</option>
                                    <option onclick="showCustomDrillInputField()" id="custom-location-option"
                                            class="drill-custom-location-text">Enter custom location
                                    </option>
                                    <option onclick="hideCustomDrillInputField()" th:each="location: ${locations}"
                                            th:value="${location}"
                                            th:text="${location}"></option>
                                </select>

                                <input id="custom-drill-input" class="drill-management-value"
                                       style="visibility: hidden; position: absolute"
                                       type="text" placeholder="Custom location" th:name="custom-location">
                            </td>
                        </tr>

                        <tr>
                            <th class="drill-management-entry">Report To</th>
                            <td class="drill-management-value-cell">
                                <select id='add-drill-officers' class="drill-management-value" th:name="officerName">
                                    <option selected disabled style="display: none">Select one...</option>
                                    <option>Officer 1</option>
                                    <option>Officer 2</option>
                                </select>
                            </td>
                        </tr>

                        <tr>
                            <th class="drill-management-entry">Participants</th>
                            <td class="drill-management-value-cell">
                                <select multiple id='add-drill-participants' class="drill-management-value"
                                        th:name="participants">-->
                                    <optgroup label="Rank">
                                        <option th:each="rank : ${ranks}" th:value="${rank}" th:text="${rank}"></option>
                                    </optgroup>
                                    <optgroup label="Flight">
                                        <option th:each="flight : ${flights}" th:value="${flight}"
                                                th:text="${flight}"></option>
                                    </optgroup>
                                    <optgroup label="Workspace">
                                        <option th:each="workspace : ${workspaces}" th:value="${workspace}"
                                                th:text="${workspace}"></option>
                                    </optgroup>
                                    <optgroup label="Team">
                                        <option th:each="team : ${teams}" th:value="${team}" th:text="${team}"></option>
                                    </optgroup>
                                </select>
                            </td>
                        </tr>

                        <tr>
                            <th class="drill-management-entry">Description</th>
                            <td class="drill-management-value-cell">
                                <textarea id='drill-description' class="drill-management-value" type="text" rows="2"
                                          cols="20" placeholder="Drill Description" th:name="description"></textarea>
                            </td>
                        </tr>
                    </table>

                    <input id="drill-id" th:name="id" type="number" style="visibility: hidden; position: absolute">


                    <div class="drill-edit-button-div">
                        <input class="drill-edit-submit" type="submit" name="submit" value="Submit">
                        <input class="drill-edit-submit drill-edit-delete" type="submit" name="delete" value="Delete"
                               onclick="return confirm('Are you sure you want to delete this event?')">
                    </div>
                </form>
        </div>

        <script type="text/javascript">
            $(document).ready(function () {

                let select_field_css = {
                    "width": "100%",
                    "font-size": "1.5vh",
                    "border-radius": "2px",
                    "vertical-align": "center"
                };

                $('#drill-location').attr("data-placeholder", "Choose location...").chosen();
                $('#drill-location').css(select_field_css);
                $('#drill-location').on('change', function () {
                    if ($(this).val() === "Enter custom location") {
                        showCustomDrillInputField();
                    } else {
                        hideCustomDrillInputField()
                    }
                })

                $('#add-drill-participants').attr("data-placeholder", "Choose participants...").chosen();
                $('#add-drill-participants').css(select_field_css);

                $('#add-drill-officers').chosen();
                $('#add-drill-officers').css(select_field_css);

                if(customLocationRequested) {
                    document.getElementById("drill_location_chosen").children[0].style.backgroundColor = "#e0e0e0";
                }
            });
        </script>
    </div>
    >
</main>
</body>
</html>